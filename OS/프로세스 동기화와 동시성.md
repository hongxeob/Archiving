# 프로세스 동기화란 ?

> 동시다발적으로 실행되는 프로세스들은 서로 협력하며 영향을 주고 받는다
프로세스들의 동기화를 고려해야 한다
## 동기화란
- 공동의 목적을 위해 동시에 수행되는 프로세스
- 프로세스들의 수행 시기를 맞추는 것
- 실행 순서 제어 : 프로세스를 올바른 순서대로 실행하기
	- 예) Writer,Reader 
	- Reader 프로세스는 특정 조건이 만족되어야만 실행 가능(Book.txt에 값이 존재한다)
- 상호 배제 : 동시에 접근해서는 안 되는 자원에 하나의 프로세스만 접근하게 하기
	- 예) 은행 송금 , 프린터 등
## 공유자원과 임계구역
### 공유 자원 
- 시스템 안에서 각 프로세스, 스레드가 함께 접근할 수 있는 자원(모니터,프린터,메모리...)이나 변수등을 의미
- 여러 프로세스 혹은 스레드가 공유하는 자원
- 전역 변수, 파일, 입출력장치, 보조기억장치 
### 임계 구역 
- 동시에 둘 이상의 프로세스,스레드가 공유 자원에 접근할 때 순서 등의 이유로 결과가 달라지는 코드 영역
- 임계 구역에 진입하고자 하면 진입한 프로세스 이외에는 대기해야 한다
- 임계 구역에 동시에 접근하면 자원의 일관성이 깨질 수 있다 -> **경쟁 상태**(레이스 컨디션)이라고 한다 
- 해결의 방법으로는 크게 `뮤텍스`,`세마포어`,`모니터` 세 가지가 있다
  - 모두 **상호 배제**, **한정 대기**, **융통성**이란 조건을 만족한다
    - >운영체제가 임계구역  문제를 해결하는 세 가지 원칙 (상호 배제를 위한 동기화!를 위한 세 가지 원칙)
      >- 상호 배제 : 한 프로세스가 임계 구역에 진입했다면 다른 프로세스는 들어올 수 없다
      >- 한정 대기 : 한 프로세스가 임계 구역에 진입하고 싶다면 언젠가는 임계 구역에 들어올 수 있어야 한다 (무한정 대기하면 안 된다)
      >- 융통성 : 한 프로세스가 다른 프로세스의 일을 방해해서는 안 된다
      >- 진행 : 임계 구역에 어떤 프로세스도 진입하지 않았다면 진입하고자 하는 프로세스는 들어갈 수 있어야 한다
  - 토대가 되는 핵심 개념은 `lock`이다. 자주 사용하는 비유로 화장실 열쇠가 있는데, A라는 사람이 화장실 열쇠를 통해 화장실을 열고 들어가면, B라는 사람은 A가 화장실에서 나와서 열쇠를 제자리에 둘 때까지 화장실에 접근할 수 없는 것이다
#### 뮤텍스
- 공유 자원을 사용하기 전에 설정하고, 사용한 후에는 해제되는 잠금
- 잠금이 설정되면 다른 프로세스나 스레드는 잠긴 해당 코드 영역에 접근 불가
- 한 번에 하나의 잠금만 가진다
#### 세마포어
- 일반화된 뮤텍스. 정수 값과 두 가지 함수(wait,signal)를 통해 공유 자원에 대한 접근을 처리한다
- wait() : 자신의 차례가 올 때까지 기다리는 함수
- signal() : 다음 프로세스로 순서를 넘겨주는 함수
- 바이너리 세마포어 : 0과 1의 두 가지 값만 가질 수 있는 세마포어. 뮤텍스와 비슷하다
  - but 뮤텍스는 **잠금**기반의 상호배제, 세마포어는 **신호**기반의 상호 배제
- 카운팅 세마포어 : 여러 개의 자원을 가질 수 있는 세마포어, 여러개의 자원에 대한 접근을 제어할 때 사용
## 교착상태 (deadlock)
두 개 이상의 프로세스들이 서로가 가진 자원을 기다리며 중단된 상태를 말한다<br>
교착 상태는 아래와 같은 원인과 해결책을 가진다
### 원인
- 상호 배제 : 한 프로세스가 자원을 독점하고 있으며 다른 프로세스는 해당 자원에 접근이 불가능하다
- 점유 대기 : 특정 프로세스가 점유한 자원을 다른 프로세스가 요청하는 상태
- 비선점 : 다른 프로세스의 자원을 강제로 가져올 수 없다
- 환형 대기 : 프로세스 A는 프로세스 B의 자원을, 프로세스 B는 프로세스 C의 자원을, 프로세스 C는 프로세스 A의 자원을 기다리는 등 서로사 서로의 자원을 요구하는 상황
### 해결 방법
- 1.자원을 할당 할 때 애초에 조건이 성립되지 않도록 설계
- 2.교착 상태 가능성이 없을 때만 자원 할당되며, 프로세스당 요청할 자원들의 최대치를 통해 자원 할당 가능 여부를 파악하는 '은행원 알고리즘'을 쓴다
- 3.교착 상태가 발생하면 사이클이 있는지 찾아보고 이에 관련된 프로세스를 한 개씩 지운다
- **4.교착상태는 매우 드물게 일어나기 때문에 이를 처리하는 비용이 더 커서 교착 상태가 발생하면 사용자가 작업을 종료한다**
  - 현대에서 쓰는 방법 ex) 교착 상태가 발생한 경우 '응답 없음'으로 처리
