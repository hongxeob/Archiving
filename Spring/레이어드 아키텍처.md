# 레이어드 아키텍처 (Layered Architecture) 란

- 레이어드 아키텍처는 많은 분야에서 사용되는 아키텍처이다
- 이름 그대로 여러 레이어를 분리하여 레이어마다 해야 할 역할을 정의해놓은 구조이다
- **코드를 논리적인 부분 혹은 역할에 따라 독립된 모듈로 나누어서 구성하는 패턴**
    - 각 모듈이 서로의 의존도에 따라 층층히 쌓듯이 연결되어서 전체의 시스템을 구현하는 구조
- 일반적으로 **프레젠테이션(presentation),비즈니스(business),퍼시스턴스(persistence),데이터베이스**의 4개의 표준 레이어로 구성한다

![61fab65cb0894541b591a461_Layered-Arch](https://user-images.githubusercontent.com/97447334/224625182-8f89163f-bcf7-4c41-943f-1859e1e22388.jpeg)

## 1. Preesentation layer (User Interface)

- **해당 시스템을 사용하는 사용자 혹은 클라이언트 시스템과 직접적으로 연결되는 부분**
- 웹사이트에서는 UI부분에 해당하고 백엔드 API에서는 엔드 포인트 부분에 해당한다
- 그러므로 여기서 API의 엔드포인트들을 정의하고 전송된 HTTP Request를 읽어 들이는 로직을 구현한다
- 그 이상의 역할은 담당 X → 실제 시스템이 구현하는 비즈니스 로직은 다음 레이어로 넘긴다
- 역할
    - EndPoint
    - Authentication
    - JSON Translation
## 2. Business layer (비즈니스 로직) , (도메인)
- 이름 그대로 비즈니스 로직을 구현하는 부분이다
- 실제 시스템이 구현해야하는 로직을 이 레이어에서 구현하게 된다
- 백엔드 API에서는 Presentation layer에서 전송된 요청을 읽어들여 요청에 맞게 동작하는 로직을 구현하면 된다
    - ex) `회원가입 요청 시 필수적인 요소들이 다 포함되어 있지 않으면 거부한다` 등이 비즈니스 로직이다
- 역할
    - 비즈니스 로직
    - Validation (검증)
    - Authorisation (권한 부여)
- 경우에 따라서 아래처럼 Service와 Domain Model을 별개 계층으로 나누거나, 아예 Domain Model을 레이어드 아키텍처와 별개의 것으로 분리하는 경우도 더러 있는 것 같다

![2010s-layered-architecture](https://user-images.githubusercontent.com/97447334/224628762-f9c29ffa-3b92-4d31-8db9-d9c2be23ca14.png)
)

## 3. Persistence layer(Data Access)

- DB와 관련된 로직을 구현하는 부분이다
- 비즈니스 레이어에서 필요한 데이터를 생성,수정,읽기 등을 처리하여 실제로 DB에서 데이터를 저장,수정,읽어 오기 등을 하는 역할을 한다
- 역할 : Storage Logic

## 기준

- layered architecture에는 몇 가지의 레이어가 존재해야하는지에 대한 기준이 없다
- 따라서 범위가 더 넓은 비즈니스를 위해서는 아래 사진에서 볼 수 있듯이 `Business layer` 와 `Persistence layer` 사이에 추가적으로 `Service layer`(혹은 Application layer)가 존재할 수 있다

![images_hojin11choi_post_71e9861a-d659-41bb-b991-9fc70d7a5881_image](https://user-images.githubusercontent.com/97447334/224626353-a96001d1-0beb-4d7a-b801-82a30b5bd945.png)


## 왜 이렇게 나누는 걸까?

>이것은 `관심사의 분리`와 연관이 있다
>- 예를 들어 비즈니스 레이어는 데이터를 어떻게 받아야 하는지, 화면에 어떻게 보여줄지 전혀 관여하지 않는다
>- 따라서 **기술적인 부분에만 집중**할 수 있지만, 변화에 반응하는 능력(민첩성)은 떨어진다는 단점이 있다

## 레이어드 아키텍처의 핵심 요소

- 레이어드 아키텍처의 핵심 요소는 **단방향 의존성**이다
    - 각각의 레이어는 오직 자기보다 하위에 있는 레이어에만 의존한다
    - `presenstation layer`는 `business layer`에게 의존하고, `business layer`는 `persistence layer`에게만 의존하게 된다
- **각 레이어의 역할이 명확**하다
    - ex) `presenstation layer`에는 비즈니스 로직이 전혀 구현되어 있지 않다

## 장점

- 각 **레이어가 독립적**이고 **역할이 분명**하므로 **코드의 확장성**이 높아진다
    - OCP 원칙을 쉽게 지키게 된다
- 코드의 구조를 파악하기 쉬울 뿐만 아니라 **재사용 가능성**도 높아진다
- 역할이 명확하게 나뉘어 있으므로 각 레이어를 테스트하는 **테스트 코드의 작성**도 훨씬 수월하다

## 단점

- 계층을 구분하기 어렵고 잘못 구분할 경우 수정이 빈번할 수 있다
- 설계시 계층의 개수 및 규모를 정하기 어렵다

## 설계시 주의 사항 - 싱크홀 안티 패턴

- 아키텍처 싱크홀 안티 패턴을 조심해야 한다
- 요청이 한 레이어에서 다른 레이어로 이동할 때 **각 레이어가 아무 비즈니스 로직도 처리하지 않고 그냥 통과**하는 것을 말한다
- 이런 흐름은 불필요한 객체 초기화 및 처리를 빈번하게 유발하고 쓸데없이 메모리를 소모하며 성능에 안 좋은 영향을 준다
- 전체 요청의 20%가 싱크홀인 정도면 그런대로 괜찮은 수준이다

## 왜 Layered Architecture 스타일을 사용하는가

- 작고 단순한 앱/웹사이트에 알맞는 아키텍처이다
    - 특히 처음 구축을 할 때 출발점으로 괜찮은 아키텍처 선택이다
- 복잡하지 않으며 어쩌면 비용도 가장 저렴한 아키텍처 스타일이므로 소규모 애플리케이션을 간편하게 개발할 수 있다
- 물론 규모가 커질수록 유지 보수성, 민첩성, 시험성, 배포성 같은 특성이 점점 나빠진다