## 들어가기 앞서) DB 커넥션을 매번 획득?

DB 커넥션을 획득할 때는 다음과 같은 복잡한 과정을 거친다.

1. 애플리케이션 로직은 DB 드라이버를 통해 커넥션을 조회한다.
2. DB 드라이버는 DB와 `TCP/IP` 커넥션을 연결한다. 물론 이 과정에서 3 way handshake같은 `TCP/IP` 연결을 위한 네트워크 동작이 발생한다.
3. DB 드라이버는 `TCP/IP` 커넥션이 연결되면 ID,PW와 기타 부가정보를 DB에 전달한다.
4. DB는 ID,PW를 통해 내부 인증을 완료하고, 내부에 DB 세션을 생성한다.
5. DB는 커넥션 생성이 완료되었다는 응답을 보낸다.
6. DB 드라이버는 커넥션 객체를 생성해서 클라이언트에 반환한다.

이처럼 Connection을 새로 만드는 것은 과정도 복잡하고 시간도 많이 소모 되는 일이다.<br>
이런 문제를 한번에 해결하는 아이디어가 바로 커넥션을 미리 생성해두고 사용하는 `커넥션 풀`(Connection Pool)이라는 방법이다!

## 커넥션 풀

>커넥션풀이란 웹 컨테이너(WAS)가 실행되면서 DB와 미리 connection(연결)을 해놓은 객체들을 pool에 저장해 두었다가,<br> 클라이언트 요청이 오면 connection을 빌려주고, 처리가 끝나면 다시 connection을 반납받아 pool에 저장하는 방식을 말한다.

## 커넥션 풀 동작 과정

<img width="709" alt="image" src="https://user-images.githubusercontent.com/97447334/228741443-78a07646-a56f-4e87-9f39-3559e0bcf01f.png">

1. 사용자가 DB를 사용하기 위하여 Connection을 요청한다.
2. 커넥션풀에서 사용되지 않고 있는 Connection 객체를 제공한다.
3. 사용자가 Connection 객체를 사용 완료하면 pool로 반환한다.

## 커넥션 풀을 사용해서 얻는 이점

### 서버의 부하를 줄여 준다.

- 자바에서는 DB Connection을 맺는 과정이 부하가 많이 걸리는 작업이라 동시에 많은 사람들이 DB 커넥션을 요구한다면 최악의 경우 서버가 죽어버리는 문제가 발생할 수 있다.
- 이러한 문제를 해결하기 위해 미리 Connection을 생성하고 재활용하여 서버에 부하를 줄여주는 용으로 사용한다.

### 서버의 한정적인 자원을 효율적으로 사용할 수 있다.

- 서버는 한정적인 자원을 가지고 있는데 요청이 올때마다 무제한의 Connection을 생성하게 된다면 전체 시스템에 성능에 문제가 생길 수 있다.
- 이러한 문제를 해결하기 위해 커넥션풀에 미리 정해진 숫자의 커넥션을 생성해서 관리한다.

## 커텍션 풀 주의사항

- 풀에 최대로 저장되는 커넥션수는 정해져 있기에 많은 요청이 발생한 경우 커넥션이 모두 사용 중이라면 반납될 때까지 대기해야한다.
    - 그렇기에 커넥션의 수를 너무 작게 설정하면, 원활한 서비스가 이루어질 수 없다. 그렇다고 커넥션수를 많이 늘려서도 안된다.
    - 커넥션 객체는 메모리를 많이 사용하기 때문에 오히려 성능을 떨어뜨릴 수도 있다.
    - **그러므로 커넥션 풀을 사용한다면 유저 수에 따라 커넥션 수를 적절하게 지정해야한다.**