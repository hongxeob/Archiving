# 5. 트랜잭션과 잠금

> 트랜잭션은 작업의 완전성을 보장해 주는 것. <br>
> 즉 논리적인 작업 셋을 모두 완벽하게 처리하거나 or 처리하지 못할 경우 원 상태로 모두 복구해야한다.<br>
> **작업의 일부만 적용되는 현상(Partial update)이 발생하지 않게 만들어주는 기능**이다.

#### 잠금(Lock)과 트랜잭션
잠금과 트랜잭션은 서로 비슷한 개념 같지만
- 잠금은 동시성을 제어하기 위한 기능
- 트랜잭션은 데이터의 정합성을 보장하기 위한 기능

하나의 회원 정보 레코드를 여러 커넥션에서 동시에 변경하려고 하는데 잠금이 없다면 하나의 데이터를 여러 커넥션에서 동시에 변경할 수 있게 된다.<br>
**잠금은 여러 커넥션에서 동시에 동일한 자원(레코드나 테이블)을 요청할 경우 순서대로 한 시점에는 하나의 커넥션만 변경할 수 있게 해주는 역할을 한다.**<br>
**격리 수준이라는 것은 하나의 트랜잭션 내에서 또는 여러 트랜잭션 간의 작업 내용을 어떻게 공유하고 차단할 것인지를 결정하는 레벨을 의미한다.**

## 5.1 트랜잭션
> 트랜잭션은 꼭 여러 개의 변경 작업을 수행하ㅏ는 쿼리가 조합됐을 때만 의미 있는 개념은 아니다.<br>
> 트랜잭션은 하나의 논리적인 작업 셋에 하나의 쿼리가 있든 두 개 이상의 쿼리가 있든 관계없이 논리적인 작업 셋 자체가 100% 적용되거나(commit을 실행시) 아무것도 적용되지 않아야 (rollback 또는 트랜잭션을 rollback 시키는 오류가 발생시) 함을 보장해 주는 것이다.

## 5.3 InnoDB 스토리지 엔진 잠금(Lock)
InnoDB 스토리지 엔진은 MySQL에서 제공하는 잠금과는 별개로 스토리지 엔진 내부에서 레코드 기반의 잠금 방식을 탑재하고 있다.<br>
InnoDB는 **레코드 기반의 잠금 방식** 때문에 MyISAM 보다는 훨씬 뛰어난 동시성 처리를 제공할 수 있다.

### 레코드(Gap) 락
레코드 자체만을 잠그는 것을 레코드 락(Record lock, Record only lock) 이라고 하며, 다른 상용 DBMS 의 레코드 락과 동일한 역할을 한다.<br>
한 가지 중요한 차이는 InnoDB 스토리지 엔진은 **레코드 자체가 아니라 인덱스의 레코드를 잠근다는 점**이다. <br>
-> `레코드 자체를 잠그느냐, 아니면 인덱스를 잠그느냐는 상당히 크고 중요한 차이를 만든다.` 
>InnoDB 에서는 대부분 보조 인덱스를 이용한 변경 작업은 넥스트 키 락 (Next key lock) 또는 갭 락 (Gap lock) 을 사용하지만 프라이머리 키 또는 유니크 인덱스에 의한 변경 작업에서는 갭 (Gap, 간격 )에 대해서는 잠그지 않고 **레코드 자체에 대해서만 락**을 건다.
